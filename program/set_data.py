# set_data.py - By: Sakiri - Sat Mar 23 2024
# version: 0.3

import json
import sys
import os

def set_data(name,journey,speed,school,time,mode,start_time):
    '''
    ä¿å­˜ç”¨æˆ·é…ç½®
    '''
    user_data={'user_name':name,'school':school,'journey':journey,'speed':speed,'time':time,'times':int(times),'mode':mode,'start_time':start_time}
    with open('./data/user_data.json','w')as f:
        json.dump(user_data,f)

def open_json():
    #æ‰“å¼€json
    with open('./data/user_data.json','r',encoding='utf-8') as f:
        load_data=json.load(f)
    return load_data

if __name__=='__main__':
    #æ£€æµ‹å’Œåˆ›å»ºuser_data.json
    file_path='./data/user_data.json'
    if os.path.exists(file_path):
        print('\033[96må­˜åœ¨user_data.json\033[0m')
    else:
        #åˆ›å»ºæ–‡ä»¶
        with open(file_path,'w') as file:
            file.write('')
        print('\033[96mè‡ªåŠ¨åˆ›å»ºäº†user_data.json\033[0m')
        print('\033[91mè·‘æ­¥ä¿¡æ¯ä¸ºç©ºï¼Œæ¥ä¸‹æ¥è¯·é€‰æ‹©â€œé‡æ–°åˆ›å»ºä¿¡æ¯æ–‡ä»¶â€\033[0m')

    print(
        'ğŸ“š                                             \033[1;35;46m   --ä½¿ç”¨é¡»çŸ¥--   \033[0m\n'
        '\nğŸ“—1ï¼Œæ—¥æœŸå°†é»˜è®¤è®¾ç½®ä¸ºå½“å‰æ—¥æœŸï¼Œç„¶åå‘åé€’å‡ï¼Œ(å¦‚æœåˆ›å»ºä¸¤å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆè·‘æ­¥æ—¥æœŸå°†ä¼šæ˜¯å½“å‰æ—¥æœŸå·²åŠå½“å‰æ—¥æœŸçš„å‰ä¸€å¤©)\n     \033[91må¦‚æœéœ€è¦è‡ªå®šä¹‰æ—¥æœŸï¼Œå¯ä»¥åœ¨åé¢çš„é€‰é¡¹æ›´æ”¹\033[0m'
        '\nğŸ““2ï¼Œæ—¶é—´è®¾ç½®æ ¼å¼ä¸ºhour:minï¼Œç¨‹åºå°†ä¼šéšæœºè®¾å®šåˆ†é’Ÿï¼Œå‰åå·®å€¼ä¸ºä¸€å°æ—¶ ä¾‹ï¼šä½ è¾“å…¥18:20ï¼Œç¨‹åºå°†åœ¨17:50~18:50èŒƒå›´å†…éšæœºå–å€¼\n     \033[91mæ³¨æ„!!æ—¶é—´çš„ : ç¬¦å·å¿…é¡»åœ¨è‹±æ–‡è¾“å…¥æ³•ä¸‹è¾“å…¥,ä¸ç„¶ä¼šæŠ¥é”™!!\033[0m'
        '\nğŸ“•3ï¼Œè·¯ç¨‹åŒç†ï¼Œå‘åå·®å€¼0.3kmï¼Œä¿ç•™åä¸¤ä½å°æ•° ä¾‹: ä½ è¾“å…¥2ï¼Œç¨‹åºå°†åœ¨2~2.3çš„èŒƒå›´éšæœºå–å€¼'
        '\nğŸ“™4ï¼Œå¯åŠ¨è„šæœ¬åï¼Œéœ€ä¿æŒæµç•…çš„ç½‘ç»œè¿æ¥åŠç‰ˆæœ¬è¾ƒæ–°çš„Microsoft Edgeæµè§ˆå™¨(Windows 10/11ç³»ç»Ÿè‡ªå¸¦)ï¼Œç”¨äºè·å–å¤©æ°”æ•°æ®å’Œè·‘æ­¥å›¾åƒ'
        '\nğŸ“˜5ï¼Œå¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨æ­¤è„šæœ¬ï¼Œéœ€è¦é€‰æ‹©â€œé‡æ–°åˆ›å»ºé…ç½®æ–‡ä»¶â€'
        '\nğŸ“—6ï¼Œæ­¤è„šæœ¬å…·æœ‰æ—¶æ•ˆæ€§ï¼Œéšç€ç›®æ ‡ç½‘å€çš„æ›´æ”¹å¯èƒ½ä¼šéšæ—¶å¤±æ•ˆ(åº”è¯¥æ²¡é‚£ä¹ˆå¿«ğŸ˜…)ï¼Œæˆ–è€…å…¶ä»–é—®é¢˜ã€‚')
    input('\033[96mäº†è§£â€œä½¿ç”¨é¡»çŸ¥â€çš„å†…å®¹åï¼ŒæŒ‰ä¸‹å›è½¦é”®å¼€å§‹åˆ›å»º/ä¿®æ”¹è·‘æ­¥ä¿¡æ¯\033[0m')

    print('ğŸ“š                                          \033[1;35;46m   --å¼€å§‹åˆ›å»º/ä¿®æ”¹è·‘æ­¥ä¿¡æ¯--   \033[0m\n')
    modes=input('ğŸ”¨é‡æ–°åˆ›å»ºä¿¡æ¯æ–‡ä»¶(\033[96mè¾“å…¥d\033[0m) or ğŸ”§åªä¿®æ”¹æŸä¸ªå€¼(\033[96mè¾“å…¥r\033[0m)')
    while True:
        if modes == "d" or modes == "r":
            break
        else:
            modes=input("\n\033[91mé”™è¯¯çš„è¾“å…¥ï¼Œè¯·é‡æ–°è¾“å…¥æœ‰æ•ˆçš„é€‰é¡¹ï¼š\033[0m")

    if modes == 'd':
        #é‡æ–°åˆ›å»ºé…ç½®æ–‡ä»¶
        print("\033[1;35;46m --é‡æ–°åˆ›å»ºé…ç½®æ–‡ä»¶-- \033[0m")
        name=input('è¾“å…¥ç”¨æˆ·å(ä½ åœ¨keepåº”ç”¨çš„æ˜µç§°)ï¼š')
        journey=input('è¾“å…¥è·¯ç¨‹ï¼š(ç”Ÿæˆæˆªå›¾ä¸Šè·‘æ­¥çš„è·¯ç¨‹ï¼Œè¾“å…¥æ•´æ•°ï¼Œç¨‹åºä¼šåœ¨ä¸€å®šèŒƒå›´å†…éšæœºå–å€¼)')
        speed=input('è¾“å…¥é…é€Ÿ(èœé¸¡ä¸€èˆ¬åœ¨7-10,ä¸šä½™åœ¨5-7,æœ‰è·‘æ­¥åŸºç¡€4-5,é«˜æ‰‹3-4):')
        time=input('è¾“å…¥æ—¶é—´(è·‘æ­¥æˆªå›¾ä¸Šæ˜¾ç¤ºå¼€å§‹è·‘æ­¥çš„æ—¶é—´ã€‚è¯¦ç»†å‚è§â€œä½¿ç”¨é¡»çŸ¥2â€)ï¼š')
        school=input('è¾“å…¥å­¦æ ¡åç§°(åœ°å)ï¼š')
        times=input('åˆ›å»ºå›¾ç‰‡å¼ æ•°ï¼š')
        mode=input('æ˜¯å¦éœ€è¦è‡ªåŠ¨è®¾ç½®èµ·ç‚¹æ—¥æœŸï¼Ÿè¯¦ç»†å‚è§â€œä½¿ç”¨é¡»çŸ¥1â€(\033[96mğŸ¤–éœ€è¦è¾“å…¥y or ğŸ§ä¸éœ€è¦è¾“å…¥n\033[0m)')

        while True:
            if mode =='y':
                start_time=input('è¯·è¾“å…¥èµ·ç‚¹æ—¥æœŸ(å¹´æœˆæ—¥ï¼Œä¾‹ï¼š2024-01-01)')
                break
            elif mode == 'n':
                start_time=0
                break
            else:
                mode=input("\n\033[91mé”™è¯¯çš„è¾“å…¥ï¼Œè¯·é‡æ–°è¾“å…¥æœ‰æ•ˆçš„é€‰é¡¹ï¼š\033[0m")
                continue
        set_data(name,journey,speed,school,time,mode,start_time)
        print('ä¿å­˜ç”¨æˆ·é…ç½®æˆåŠŸ Ciallo~(âˆ ãƒ»Ï‰< )âŒ’â˜† æŒ‰ä¸‹ä»»æ„é”®é€€å‡º')

    elif modes == 'r':
        #ä¿®æ”¹æŸä¸ªæ•°ç»„
        print("\033[1;35;46m --ä¿®æ”¹ä¸€ä¸ªæˆ–å¤šä¸ªå€¼-- \033[0m")
        #ç¡®è®¤jsonæ–‡ä»¶æ˜¯å¦æœ‰å†…å®¹
        try:
            load_data=open_json()
        except json.decoder.JSONDecodeError:
            print('\n\033[91må½“å‰ç”¨æˆ·æ•°æ®ä¸ºç©ºï¼Œè¯·é‡æ–°æ‰§è¡Œæ­¤è„šæœ¬ï¼Œå¹¶é€‰æ‹©"é‡æ–°åˆ›å»ºé…ç½®æ–‡ä»¶"\033[0m')
            sys.exit(1)
        i=0
        while i == 0:
            print('\n\033[96må½“å‰çš„æ•°æ®å†…å®¹ï¼š\033[0m')
            #è¾“å‡ºä¿¡æ¯å†…å®¹
            for key,value in dict.items(load_data):
                if key == 'user_name':
                    print(f'keepæ˜µç§°:{str(value)}------------è¾“å…¥{key}æ¥æ›´æ”¹è¿™ä¸ªå€¼')
                elif key == 'school':
                    print(f'\nå­¦æ ¡åç§°:{str(value)}------------è¾“å…¥{key}æ¥æ›´æ”¹è¿™ä¸ªå€¼')
                elif key == 'journey':
                    print(f'\nè·¯ç¨‹:{str(value)}------------è¾“å…¥{key}æ¥æ›´æ”¹è¿™ä¸ªå€¼')
                elif key == 'speed':
                    print(f'\né…é€Ÿ:{str(value)}------------è¾“å…¥{key}æ¥æ›´æ”¹è¿™ä¸ªå€¼')
                elif key == 'time':
                    print(f'\nè·‘æ­¥å¼€å§‹æ—¶é—´:{str(value)}------------è¾“å…¥{key}æ¥æ›´æ”¹è¿™ä¸ªå€¼')
                elif key == 'times':
                    print(f'\nåˆ›å»ºå›¾åƒå¼ æ•°:{str(value)}------------è¾“å…¥{key}æ¥æ›´æ”¹è¿™ä¸ªå€¼')
                elif key == 'mode':
                    mode_value=[key,value]
                    if value=='y':
                        print('\nå½“å‰è‡ªåŠ¨è®¡ç®—èµ·ç‚¹æ—¥æœŸ',end=' ')
                    else :
                        print('\nå½“å‰å…³é—­è‡ªåŠ¨è®¡ç®—èµ·ç‚¹æ—¥æœŸ',end=' ')
                    print('------------è¾“å…¥modeä»¥å¼€å…³è¿™ä¸ªè®¾ç½®')
            #ä¿®æ”¹å†…å®¹
            in_key=input('\nè¾“å…¥éœ€è¦ä¿®æ”¹çš„æ•°æ®ï¼š')
            if in_key == 'mode':
                if mode_value[1] == 'y':
                    load_data[in_key]='n'
                    in_value=input('èµ·ç‚¹æ—¥æœŸ(å¹´-æœˆ-æ—¥æ ¼å¼):')
                    load_data['start_time']=in_value
                    print('è‡ªåŠ¨è®¡ç®—èµ·ç‚¹æ—¥æœŸå·²å…³é—­')
                else :
                    load_data[in_key]='y'
                    load_data['start_time']=0
                    print('è‡ªåŠ¨è®¡ç®—èµ·ç‚¹æ—¥æœŸå·²æ‰“å¼€')
            else :
                in_value=input('è¾“å…¥'+in_key+'çš„æ–°å€¼ï¼š')
                load_data[in_key]=in_value

            #ä¿å­˜ä¿®æ”¹
            i=input('ä¿å­˜æˆåŠŸ,è¾“å…¥\033[91m1\033[0mä»¥é€€å‡ºä¿®æ”¹è„šæœ¬,è¾“å…¥\033[91m0\033[0måˆ™ç»§ç»­ä¿®æ”¹å†…å®¹\n')
            i=int(i)
        with open("./data/user_data.json",'w',encoding='utf-8') as f:
            json.dump(load_data,f,ensure_ascii=False)
        print('ä¿å­˜ç”¨æˆ·é…ç½®æˆåŠŸ Ciallo~(âˆ ãƒ»Ï‰< )âŒ’â˜† æŒ‰ä¸‹ä»»æ„é”®é€€å‡º')